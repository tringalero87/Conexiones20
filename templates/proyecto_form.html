{% extends "base.html" %}

{#
    Este template se utiliza tanto para crear un nuevo proyecto como para editar uno existente.
    - La variable 'titulo' se pasa desde la ruta de Flask para el encabezado.
    - La variable 'proyecto' existe solo cuando se está editando, lo que permite
      cambiar dinámicamente el texto de la interfaz.
    - El objeto 'form' es una instancia de un formulario Flask-WTF (ProjectForm) que
      maneja la renderización de campos, la validación y la protección CSRF.
#}

{% block content %}
<div class="page-header">
    <div>
        <h1>{{ titulo }}</h1>
        <p class="text-secondary">Completa la información para {{ 'crear un nuevo' if not proyecto else 'actualizar el' }} proyecto.</p>
    </div>
</div>

<div class="card">
    <div class="card-body p-4">
        
        {#
            El atributo 'novalidate' en el formulario previene la validación nativa del navegador,
            permitiendo que la validación del lado del servidor de Flask-WTF se encargue de todo.
        #}
        <form method="POST" action="" novalidate>
            
            {#
                form.hidden_tag() es una macro de Flask-WTF que renderiza cualquier campo oculto
                en el formulario. Es crucial porque incluye automáticamente el token CSRF,
                protegiendo la aplicación contra ataques de falsificación de solicitudes entre sitios.
            #}
            {{ form.hidden_tag() }}
            
            <!-- Campo para el Nombre del Proyecto -->
            <div class="mb-3">
                {# Renderiza la etiqueta <label> para el campo 'nombre'. #}
                {{ form.nombre.label(class="form-label fw-bold") }}
                
                {#
                    Renderiza el campo <input type="text">.
                    - La clase 'is-invalid' de Bootstrap se añade condicionalmente si el campo
                      tiene errores de validación después de un envío fallido.
                #}
                {{ form.nombre(class="form-control form-control-lg" + (" is-invalid" if form.nombre.errors else ""), id="project-name-input") }}
                
                {# Bucle para mostrar los mensajes de error de validación para este campo. #}
                {% if form.nombre.errors %}
                    <div class="invalid-feedback">
                        {% for error in form.nombre.errors %}
                            <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
                <small class="form-text text-muted">
                    El nombre debe ser único y descriptivo para el proyecto.
                </small>
            </div>

            <!-- Campo para la Descripción del Proyecto -->
            <div class="mb-4">
                {# Renderiza la etiqueta <label> para el campo 'descripcion'. #}
                {{ form.descripcion.label(class="form-label fw-bold") }}
                
                {# Renderiza el campo <textarea>. #}
                {{ form.descripcion(class="form-control" + (" is-invalid" if form.descripcion.errors else ""), id="project-description-textarea") }}
                
                {# Bucle para mostrar los mensajes de error de validación, si los hubiera. #}
                 {% if form.descripcion.errors %}
                    <div class="invalid-feedback">
                        {% for error in form.descripcion.errors %}
                            <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
                <small class="form-text text-muted">
                    Proporciona detalles adicionales sobre el alcance o los objetivos del proyecto.
                </small>
            </div>

            <!-- Sección de Botones de Acción -->
            <div class="d-flex justify-content-end border-top pt-3 mt-4">
                {# Botón para cancelar la operación y volver a la lista de proyectos. #}
                <a href="{{ url_for('proyectos.listar_proyectos') }}" class="btn btn-secondary me-3">Cancelar</a>
                
                {#
                    Renderiza el botón <input type="submit"> del formulario.
                    El texto del botón se define en la clase del formulario en forms.py.
                #}
                {{ form.submit(class="btn btn-primary btn-lg") }}
            </div>
        </form>
    </div>
</div>
{% endblock %}
