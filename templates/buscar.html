{% extends "base.html" %}

{#
    Este template renderiza la página de resultados de la búsqueda.
    Muestra una lista de las conexiones que coinciden con el término de búsqueda
    introducido por el usuario en la barra de navegación.
#}

{% block content %}
<div class="page-header">
    <div>
        {# Se muestra un título dinámico que incluye el término de búsqueda para dar contexto. #}
        <h1>{{ titulo }}</h1>
        <p class="text-secondary">
            {% if resultados %}
                Se encontraron {{ resultados|length }} resultado(s).
            {% else %}
                No se encontraron resultados para tu búsqueda.
            {% endif %}
        </p>
    </div>
</div>

<div class="row">
    <div class="col-12">
        {#
            Se comprueba si la lista 'resultados' (pasada desde la ruta de Flask)
            tiene elementos. Si es así, se muestra la lista.
        #}
        {% if resultados %}
            <div class="list-group">
                {# Se itera sobre cada 'resultado' para mostrarlo en un formato de lista. #}
                {% for resultado in resultados %}
                <a href="{{ url_for('conexiones.detalle_conexion', conexion_id=resultado.id) }}" class="list-group-item list-group-item-action">
                    <div class="d-flex w-100 justify-content-between">
                        <h5 class="mb-1">{{ resultado.codigo_conexion|e }}</h5>
                        <small class="text-muted">Proyecto: {{ resultado.proyecto_nombre|e }}</small>
                    </div>
                    <p class="mb-1">{{ resultado.descripcion|truncate(150)|e if resultado.descripcion else 'Sin descripción.' }}</p>
                    <small class="text-muted">Solicitado por: {{ resultado.solicitante_nombre|e if resultado.solicitante_nombre else 'N/A' }}</small>
                </a>
                {% endfor %}
            </div>
        {% else %}
            {#
                Bloque 'else' del bucle for. Se muestra si la lista 'resultados' está vacía.
                Esto proporciona un feedback claro al usuario de que su búsqueda no produjo
                ningún resultado.
            #}
            <div class="empty-state text-center p-5">
                <div class="card card-body">
                    <i class="bi bi-search" style="font-size: 3rem;"></i>
                    <h4 class="mt-3">No se encontraron resultados</h4>
                    <p class="text-secondary">
                        No se encontraron conexiones que coincidan con "<strong>{{ query|e }}</strong>".<br>
                        Intenta con otro código de conexión o revisa la ortografía.
                    </p>
                    <div class="mt-3">
                        <a href="{{ url_for('main.dashboard') }}" class="btn btn-primary">Volver al Dashboard</a>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
